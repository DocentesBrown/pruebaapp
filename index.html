<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mi Tienda</title>
    <style>
        /* --- VARIABLES --- */
        :root {
            --primary: #007AFF; 
            --accent: #FF3B30;
            --bg: #F2F2F7;
            --card: #FFFFFF;
            --text: #000000;
            --text-sec: #8E8E93;
            --radius: 12px;
            --max-width: 1100px; /* Ancho m√°ximo en PC */
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
            margin: 0; background: var(--bg); color: var(--text);
            padding-bottom: 100px; -webkit-tap-highlight-color: transparent;
        }

        /* --- LAYOUT CENTRALIZADO PARA PC --- */
        .app-container {
            max-width: var(--max-width);
            margin: 0 auto;
            min-height: 100vh;
            background: var(--bg); /* En PC se ver√° centrado */
        }

        /* --- HEADER --- */
        header {
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 15px 20px; position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #e5e5e5;
        }
        .header-content { width: 100%; max-width: var(--max-width); margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .brand { font-weight: 800; font-size: 1.4rem; letter-spacing: -0.5px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: var(--primary); padding: 5px; }
        .btn-text { background: none; border: none; font-size: 1rem; font-weight: 600; color: var(--primary); cursor: pointer; }

        /* --- SIDEBAR --- */
        .sidebar { 
            position: fixed; top: 0; left: -300px; width: 300px; height: 100%; 
            background: white; z-index: 2000; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex; flex-direction: column; box-shadow: 4px 0 15px rgba(0,0,0,0.1);
        }
        .sidebar.open { left: 0; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1999; display:none; opacity:0; transition:0.3s; }
        .overlay.open { display:block; opacity:1; }
        
        .sidebar-head { padding: 20px; display:flex; justify-content:space-between; align-items:center; font-weight:bold; font-size:1.2rem; border-bottom:1px solid #eee; }
        .sidebar-body { flex:1; overflow-y:auto; padding:10px; }
        .sidebar-item { padding:15px; border-radius:10px; margin-bottom:5px; cursor:pointer; color:#333; transition:0.2s; }
        .sidebar-item:hover { background:#f5f5f7; }
        .sidebar-item.active { background: #e0efff; color: var(--primary); font-weight:600; }
        .sidebar-foot { padding:20px; border-top:1px solid #eee; }

        /* --- ADMIN PANEL --- */
        #adminPanel { display: none; padding: 20px; background: white; margin: 20px; border-radius: var(--radius); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .admin-visible #adminPanel { display: block; animation: fadeDown 0.3s; }
        @keyframes fadeDown { from{opacity:0; transform:translateY(-10px);} to{opacity:1; transform:translateY(0);} }
        
        .form-grid { display: grid; gap: 15px; grid-template-columns: 1fr; }
        /* En PC, el formulario se pone en 2 columnas */
        @media (min-width: 768px) { .form-grid { grid-template-columns: 1fr 1fr; } }

        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; font-family: inherit; }
        input:focus, textarea:focus { border-color: var(--primary); outline: none; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: scale(1.01); }
        .btn-sec { background: #eee; color: #333; margin-top: 10px; }
        .btn-danger { background: #ff3b30; color: white; margin-top: 15px; }

        .photo-area { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .btn-photo { background: #f9f9f9; border: 2px dashed #ccc; border-radius: 8px; padding: 20px; cursor: pointer; text-align: center; color: #666; transition:0.2s; }
        .btn-photo:hover { background: #eef; border-color: var(--primary); color: var(--primary); }
        
        /* --- CATEGOR√çAS & GRILLA --- */
        .cat-scroll { 
            display: flex; gap: 10px; overflow-x: auto; padding: 15px 20px; scrollbar-width: none; 
            border-bottom: 1px solid #eee; background: var(--bg);
        }
        .cat-pill { 
            background: white; padding: 8px 18px; border-radius: 20px; font-weight: 500; cursor: pointer; 
            white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition:0.2s;
        }
        .cat-pill.active { background: var(--text); color: white; transform: scale(1.05); }

        .grid { 
            display: grid; padding: 20px; gap: 20px;
            /* AQU√ç EST√Å LA MAGIA RESPONSIVA: */
            grid-template-columns: repeat(2, 1fr); /* Celular: 2 columnas */
        }
        /* PC: Ajusta autom√°ticamente las columnas seg√∫n el ancho */
        @media (min-width: 768px) { 
            .grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); } 
        }

        .card { 
            background: white; border-radius: var(--radius); overflow: hidden; position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s;
            display: flex; flex-direction: column;
        }
        /* Efecto Hover solo en PC */
        @media (min-width: 1024px) {
            .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        }
        .card.no-stock { opacity: 0.5; }

        .img-wrap { width: 100%; aspect-ratio: 1/1; position: relative; background: #eee; }
        .img-wrap img { width: 100%; height: 100%; object-fit: cover; }
        .badge { position: absolute; top: 10px; left: 10px; padding: 4px 8px; border-radius: 4px; color: white; font-size: 0.7rem; font-weight: bold; }
        .bg-promo { background: var(--accent); }
        .bg-stock { background: #333; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 1rem; }

        .card-info { padding: 12px; display:flex; flex-direction:column; flex-grow:1; }
        .c-title { font-weight: 600; margin-bottom: 5px; color: var(--text); }
        .c-desc { font-size: 0.85rem; color: var(--text-sec); margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .c-price { font-weight: 800; font-size: 1.1rem; margin-top: auto; }
        .old-p { text-decoration: line-through; color: #999; font-size: 0.8rem; margin-right: 5px; }

        .btn-add { 
            position: absolute; bottom: 10px; right: 10px; width: 35px; height: 35px; border-radius: 50%;
            background: var(--text); color: white; border: none; font-size: 1.2rem; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.2s;
        }
        .btn-add:active { transform: scale(0.9); }
        
        .card-actions { position: absolute; top:10px; right:10px; display:none; gap:5px; }
        .admin-visible .card-actions { display:flex; }
        .act-btn { width:32px; height:32px; border-radius:50%; background:white; border:none; box-shadow:0 2px 5px rgba(0,0,0,0.2); cursor:pointer; }

        /* --- DOCK CARRITO --- */
        .dock { 
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: #1c1c1e; color: white; padding: 15px 30px; border-radius: 40px;
            display: flex; align-items: center; gap: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 500; transition: 0.3s; width: auto; min-width: 250px; justify-content: space-between;
        }
        .dock:hover { transform: translateX(-50%) scale(1.05); }

        /* --- MODALES --- */
        .modal-bg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        /* En PC el modal es centrado, en m√≥vil es bottom-sheet */
        .modal-box { 
            background: white; width: 90%; max-width: 500px; padding: 30px; border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); position: relative; animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from{transform:scale(0.8); opacity:0;} to{transform:scale(1); opacity:1;} }
        
        @media (max-width: 768px) {
            .modal-bg { align-items: flex-end; }
            .modal-box { border-radius: 25px 25px 0 0; max-width: 100%; animation: slideUp 0.3s; }
            @keyframes slideUp { from{transform:translateY(100%);} to{transform:translateY(0);} }
        }

        .close-btn { position: absolute; top: 20px; right: 20px; border: none; background: #eee; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; }
        .cart-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .wa-btn { display: block; background: #25D366; color: white; text-align: center; padding: 15px; border-radius: 12px; text-decoration: none; font-weight: bold; margin-top: 20px; }

        /* Loader */
        #loader { position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg); z-index:4000; display:flex; justify-content:center; align-items:center; }
        .spinner { width:40px; height:40px; border:4px solid #ddd; border-top:4px solid var(--primary); border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin { to {transform: rotate(360deg);} }

    </style>
</head>
<body id="mainBody">

    <div id="loader"><div class="spinner"></div></div>

    <div class="app-container">
        
        <header>
            <div class="header-content">
                <button class="btn-icon" onclick="toggleMenu()">‚ò∞</button>
                <div class="brand">Mi Tienda</div>
                <button class="btn-text" onclick="checkLoginAccess()">Admin</button>
            </div>
        </header>

        <div class="overlay" id="menuOverlay" onclick="toggleMenu()"></div>
        <div class="sidebar" id="sidebar">
            <div class="sidebar-head">Men√∫ <button class="btn-icon" onclick="toggleMenu()">‚úï</button></div>
            <div class="sidebar-body" id="sidebarList"></div>
            <div class="sidebar-foot">
                <a href="#" id="waContact" target="_blank" style="display:block; margin-bottom:10px; text-decoration:none; color:#333;">üí¨ WhatsApp</a>
                <a href="#" id="igContact" target="_blank" style="display:block; text-decoration:none; color:#333;">üì∑ Instagram</a>
            </div>
        </div>

        <div id="adminPanel">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <h2>Gesti√≥n</h2>
                <button class="btn-text" onclick="togglePassMode(true)">Cambiar Clave</button>
            </div>
            <input type="hidden" id="editId">
            
            <div class="form-grid">
                <input type="text" id="pName" placeholder="Nombre Producto">
                <input type="text" id="pCat" placeholder="Categor√≠a" list="catDatalist">
            </div>
            <textarea id="pDesc" placeholder="Descripci√≥n..." style="margin-top:10px;"></textarea>
            
            <div class="form-grid" style="margin-top:10px;">
                <input type="number" id="pPrice" placeholder="Precio ($)">
                <input type="number" id="pPromo" placeholder="Promo (Opcional)">
            </div>
            
            <div class="photo-area">
                <div class="btn-photo" onclick="document.getElementById('fileInputCam').click()">üì∏<br>C√°mara</div>
                <div class="btn-photo" onclick="document.getElementById('fileInputGal').click()">üìÅ<br>Galer√≠a</div>
            </div>
            <div id="uploadStatus" style="text-align:center; color:#666; font-size:0.9rem;">Sube una foto</div>

            <input type="file" id="fileInputCam" accept="image/*" capture="environment" onchange="uploadToDrive(this)" style="display:none;">
            <input type="file" id="fileInputGal" accept="image/*" onchange="uploadToDrive(this)" style="display:none;">
            <input type="hidden" id="pImg">

            <select id="pStock" style="margin-top:10px;"><option value="SI">‚úÖ En Stock</option><option value="NO">‚ùå Agotado</option></select>
            <datalist id="catDatalist"></datalist>

            <div class="form-grid" style="margin-top:20px;">
                <button class="btn btn-primary" onclick="saveProductToServer()" id="btnSave">Guardar</button>
                <button class="btn btn-sec" onclick="cancelEdit()" id="btnCancel" style="display:none">Cancelar</button>
            </div>
            <button class="btn btn-danger" onclick="logout()">Salir</button>
        </div>

        <div class="cat-scroll" id="catContainer"></div>
        <div class="grid" id="grid"></div>
        
    </div> <div class="dock" id="cartBtn" onclick="openCart()" style="display:none;">
        <span>üõçÔ∏è Mi Pedido</span>
        <span id="cartTotal" style="font-weight:bold">$0</span>
    </div>

    <div class="modal-bg" id="cartModal" onclick="if(event.target===this)closeCart()">
        <div class="modal-box">
            <button class="close-btn" onclick="closeCart()">‚úï</button>
            <h2>Tu Carrito</h2>
            <div id="cartList" style="margin-top:20px; max-height:40vh; overflow-y:auto;"></div>
            <h3 style="text-align:right; margin-top:20px;">Total: <span id="modalTotal">$0</span></h3>
            <a href="#" id="waLink" class="wa-btn" target="_blank">Enviar a WhatsApp</a>
            <button onclick="clearCart()" class="btn-text" style="width:100%; margin-top:10px; color:#999;">Vaciar</button>
        </div>
    </div>

    <div class="modal-bg" id="loginModal">
        <div class="modal-box" id="loginFormBox">
            <button class="close-btn" onclick="closeLogin()">‚úï</button>
            <h2>Acceso Admin</h2>
            <input type="text" id="loginUser" placeholder="Usuario" style="margin-bottom:10px;">
            <input type="password" id="loginPass" placeholder="Contrase√±a" style="margin-bottom:20px;">
            <button class="btn btn-primary" onclick="doLogin()">Entrar</button>
        </div>
        <div class="modal-box" id="changePassBox" style="display:none;">
            <button class="close-btn" onclick="togglePassMode(false)">‚úï</button>
            <h2>Nueva Clave</h2>
            <input type="password" id="oldPass" placeholder="Clave Actual" style="margin-bottom:10px;">
            <input type="password" id="newPass" placeholder="Nueva Clave" style="margin-bottom:10px;">
            <input type="password" id="confirmPass" placeholder="Confirmar" style="margin-bottom:20px;">
            <button class="btn btn-primary" onclick="saveNewPass()">Guardar</button>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxMUSMKycILcGWQVbUbAy7MtgvvvWhM0-QdlMdp4sXxirDHKz-LvaQgaYuku3Td8puS4Q/exec";
        const PHONE = "5491138614767"; 
        const INSTAGRAM_URL = "https://instagram.com/TU_USUARIO"; 

        let products = [], cart = [], activeCat = 'all';
        let isLoggedIn = false;

        function getCreds() { const s = localStorage.getItem('shop_creds'); return s ? JSON.parse(s) : { u: 'LUCAS', p: 'FAGA' }; }

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('menuOverlay').classList.toggle('open');
        }

        // LOGIN SYSTEM
        function checkLoginAccess() { 
            if (isLoggedIn) {
                document.getElementById('mainBody').classList.toggle('admin-visible');
                window.scrollTo(0,0);
            } else {
                document.getElementById('loginModal').style.display='flex';
                document.getElementById('loginFormBox').style.display='block';
                document.getElementById('changePassBox').style.display='none';
            }
        }
        function doLogin() {
            const u = document.getElementById('loginUser').value, p = document.getElementById('loginPass').value, c = getCreds();
            if (u === c.u && p === c.p) { isLoggedIn = true; closeLogin(); document.getElementById('mainBody').classList.add('admin-visible'); } else alert("Datos incorrectos");
        }
        function closeLogin() { document.getElementById('loginModal').style.display = 'none'; }
        function logout() { isLoggedIn = false; document.getElementById('mainBody').classList.remove('admin-visible'); alert("Sesi√≥n cerrada"); }
        function togglePassMode(show) { document.getElementById('loginFormBox').style.display = show?'none':'block'; document.getElementById('changePassBox').style.display = show?'block':'none'; }
        function saveNewPass() {
            const o = document.getElementById('oldPass').value, n = document.getElementById('newPass').value, c = document.getElementById('confirmPass').value, r = getCreds();
            if (o !== r.p) return alert("Actual incorrecta"); if (n !== c) return alert("No coinciden"); if (n.length<4) return alert("Muy corta");
            localStorage.setItem('shop_creds', JSON.stringify({ u: 'LUCAS', p: n })); alert("Listo"); closeLogin();
        }

        // FOTOS
        function uploadToDrive(input) {
            const file = input.files[0]; const status = document.getElementById('uploadStatus');
            if(!file) return; if(file.size>5*1024*1024) return alert("M√°ximo 5MB");
            status.innerText = "‚è≥ Subiendo...";
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = async function() {
                try {
                    const res = await fetch(API_URL, { method: "POST", body: JSON.stringify({ action: "uploadImage", image: reader.result.split(',')[1], mimeType: file.type, filename: file.name }) });
                    const data = await res.json();
                    if(data.result === "success") { document.getElementById('pImg').value = data.url; status.innerText = "‚úÖ Foto OK"; status.style.color = "green"; } else throw new Error();
                } catch(e) { status.innerText = "Error subiendo"; status.style.color = "red"; }
            };
        }

        // LOGICA NEGOCIO
        async function init() {
            document.getElementById('loader').style.display = 'flex';
            document.getElementById('waContact').href = `https://wa.me/${PHONE}`; document.getElementById('igContact').href = INSTAGRAM_URL;
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                products = data.products || [];
                renderCats(); renderGrid('all');
            } catch (err) { alert("Error conectando"); } finally { document.getElementById('loader').style.display = 'none'; }
        }

        async function saveProductToServer() {
            const img = document.getElementById('pImg').value, name = document.getElementById('pName').value, price = document.getElementById('pPrice').value;
            if(!name || !price) return alert("Falta nombre/precio"); if(!img) return alert("Falta foto");
            document.getElementById('loader').style.display = 'flex';
            const payload = {
                action: document.getElementById('editId').value ? "edit" : "add",
                id: document.getElementById('editId').value || Date.now(),
                name: name, price: price, promo: document.getElementById('pPromo').value,
                img: img, cat: document.getElementById('pCat').value || "Varios",
                stock: document.getElementById('pStock').value, desc: document.getElementById('pDesc').value 
            };
            try { await fetch(API_URL, { method: "POST", body: JSON.stringify(payload) }); cancelEdit(); await init(); } catch(e) { alert("Error"); } finally { document.getElementById('loader').style.display = 'none'; }
        }

        async function deleteProduct(id) {
            if(!confirm("¬øBorrar?")) return; document.getElementById('loader').style.display = 'flex';
            try { await fetch(API_URL, { method: "POST", body: JSON.stringify({ action: "delete", id: id }) }); await init(); } catch(e) {} finally { document.getElementById('loader').style.display = 'none'; }
        }

        function renderCats() {
            const cats = ['Todos', ...new Set(products.map(p => p.cat))];
            const c = document.getElementById('catContainer'); const sb = document.getElementById('sidebarList'); const dl = document.getElementById('catDatalist');
            c.innerHTML = ''; sb.innerHTML = ''; dl.innerHTML = '';
            cats.forEach(x => { 
                const cls = activeCat===x ? 'active' : '';
                c.innerHTML += `<div class="cat-pill ${cls}" onclick="filter('${x==='Todos'?'all':x}')">${x}</div>`;
                sb.innerHTML += `<div class="sidebar-item ${cls}" onclick="filter('${x==='Todos'?'all':x}'); toggleMenu()">${x}</div>`;
                if(x!=='Todos') dl.innerHTML += `<option value="${x}">`;
            });
        }
        
        function filter(c) { activeCat=c; renderCats(); renderGrid(c); }
        
        function renderGrid(c) {
            const g = document.getElementById('grid'); g.innerHTML = '';
            const list = c === 'all' ? products : products.filter(p => p.cat === c);
            if(list.length === 0) { g.innerHTML = '<p style="grid-column:1/-1; text-align:center; color:#999; margin-top:50px;">Sin productos</p>'; return; }
            list.forEach(p => {
                const isPromo = p.promoPrice && p.promoPrice < p.price;
                g.innerHTML += `
                <div class="card ${!p.hasStock?'no-stock':''}">
                    <div class="card-actions"><button class="act-btn" onclick='editP(${JSON.stringify(p)})'>‚úèÔ∏è</button><button class="act-btn btn-del" onclick="deleteProduct(${p.id})">üóëÔ∏è</button></div>
                    <div class="img-wrap">${isPromo?'<span class="badge bg-promo">OFERTA</span>':''}${!p.hasStock?'<span class="badge bg-stock">AGOTADO</span>':''}<img src="${p.img}"></div>
                    <div class="card-info">
                        <div class="c-title">${p.name}</div>
                        ${p.desc ? `<div class="c-desc">${p.desc}</div>` : ''}
                        <div class="c-price">${isPromo ? `<span class="old-p">$${p.price}</span> <span class="promo">$${p.promoPrice}</span>` : `$${p.price}`}</div>
                        <button class="btn-add" onclick="addCart(${p.id})" ${!p.hasStock?'disabled':''}>${p.hasStock?'+':'‚úï'}</button>
                    </div>
                </div>`;
            });
        }

        function editP(p) {
            if(!isLoggedIn) return checkLoginAccess();
            document.getElementById('editId').value = p.id;
            document.getElementById('pName').value = p.name; document.getElementById('pPrice').value = p.price; document.getElementById('pPromo').value = p.promoPrice||'';
            document.getElementById('pImg').value = p.img; document.getElementById('pCat').value = p.cat; document.getElementById('pStock').value = p.hasStock?'SI':'NO'; document.getElementById('pDesc').value = p.desc || ''; 
            document.getElementById('uploadStatus').innerText = "‚úÖ Foto OK"; document.getElementById('btnSave').innerText = "Actualizar"; document.getElementById('btnCancel').style.display = 'block';
            document.getElementById('mainBody').classList.add('admin-visible'); window.scrollTo(0,0);
        }
        function cancelEdit() {
            document.getElementById('editId').value = ''; document.getElementById('pName').value = ''; document.getElementById('pPrice').value = ''; document.getElementById('pPromo').value = '';
            document.getElementById('pImg').value = ''; document.getElementById('pDesc').value = ''; document.getElementById('btnSave').innerText = "Guardar"; document.getElementById('btnCancel').style.display = 'none';
            document.getElementById('uploadStatus').innerText = "Sube una foto";
        }
        
        function addCart(id) { const p = products.find(x=>x.id==id); if(p&&p.hasStock){ cart.push(p); updateCart(); } }
        function updateCart() {
            const t = cart.reduce((a,b)=>a+(b.promoPrice||b.price),0);
            document.getElementById('cartTotal').innerText = '$'+t; document.getElementById('modalTotal').innerText = '$'+t;
            document.getElementById('cartBtn').style.display = cart.length?'flex':'none';
        }
        function openCart() {
            const l = document.getElementById('cartList'); l.innerHTML = ''; const g = {}; cart.forEach(i=>{ if(!g[i.id])g[i.id]={...i,q:0}; g[i.id].q++; });
            let msg = "Hola! Pedido:%0A"; Object.values(g).forEach(i=>{ const pr = i.promoPrice||i.price; l.innerHTML+=`<div class="cart-row"><span>${i.name} (x${i.q})</span><b>$${pr*i.q}</b></div>`; msg+=`- ${i.name} (x${i.q}): $${pr*i.q}%0A`; });
            msg+=`%0ATotal: $${cart.reduce((a,b)=>a+(b.promoPrice||b.price),0)}`;
            document.getElementById('waLink').href=`https://wa.me/${PHONE}?text=${msg}`;
            document.getElementById('cartModal').style.display='flex';
        }
        function closeCart(){document.getElementById('cartModal').style.display='none';}
        function clearCart(){cart=[];updateCart();closeCart();}
        init();
    </script>
</body>
</html>
